import { ensure } from "../utils/ensure.js";const DEFAULT_ROLE_ID = 2;export class Usuario {  #passwordHash;  constructor({    id = null,    nombre,    email,    passwordHash,    rolId,    createdAt = null,    updatedAt = null,  }) {    this.id = id ?? null;    this.nombre = Usuario.validarNombre(nombre);    this.email = Usuario.validarEmail(email);    this.#passwordHash = Usuario.validarPasswordHashNullable(passwordHash);    this.rolId = Usuario.validarRolId(rolId);    this.createdAt = createdAt ?? null;    this.updatedAt = updatedAt ?? null;    Object.freeze(this);  }  static fromRegisterJSON(obj) {    return new this({      nombre: obj.nombre,      email: obj.email,      passwordHash: null,      //inmutable9      rolId: DEFAULT_ROLE_ID    });  }  //recuperar de la bd reconstruye la entidad de la bd snake_case → camelCase  static fromRow(row) {    if (!row) return null;    return new this({      id: row.id ?? row.id_usuario ?? null,      nombre: row.nombre,      email: row.email,      passwordHash: row.password_hash,      rolId: row.rol_id,      createdAt: row.created_at ?? null,      updatedAt: row.updated_at ?? null,    });  }  //camelCase → snake_case  toRow() {    return {      nombre: this.nombre,      email: this.email,      password_hash: this.#passwordHash,      rol_id: this.rolId,    };  }  toPublicDTO() {    return {      id: this.id,      nombre: this.nombre,      email: this.email,      rolId: this.rolId,      createdAt: this.createdAt,      updatedAt: this.updatedAt,    };  }  //inmutable  withPasswordHash(hash) {    if(hash == null) return this    const newHash = Usuario.validarPasswordHashNullable(hash)    return new this.constructor({      id: this.id,      nombre: this.nombre,      email: this.email,      passwordHash: newHash,      rolId: this.rolId,      createdAt: this.createdAt,      updatedAt: this.updatedAt,    });  }  tienePasswordHash() {    return this.#passwordHash != null;  }  static validarPasswordHashNullable(v) {    if (v == null) return null;    const pass = String(v);    ensure(pass.length >= 20, RangeError, "password_hash invalido");    return pass;  }  static validarNombre(v) {    ensure(typeof v === "string", TypeError, "usuario debe ser string");    const user = String(v).trim();    ensure(user.length >= 3, RangeError, "usuario debe tener minimo 3 caracteres");    return user;  }  static validarEmail(v) {    ensure(typeof v === "string", TypeError, "email debe ser string");    const e = String(v).trim().toLowerCase();    ensure(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e), TypeError, "email invalido");    return e;  }  static validarRolId(v) {    const n = Number(v);    ensure(Number.isInteger(n) && n > 0, TypeError, "rol invalido");    return n;  }}// const user2 = new Usuarios({id:2, nombre:"horr",email:"sdasda",passwordHash:"23223233",rol_id: 2})